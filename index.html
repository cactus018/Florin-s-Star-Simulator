<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=0.5, maximum-scale=5, user-scalable=yes">
  <title>Florin's Star Simulator</title>
  <style>
html, body {
  height: 100%;
  margin: 0;
  background: #000;
  touch-action: none;
  overflow: hidden;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}
.center-wrap {
  position: absolute;
  top: 50%;
  left: 50%;
  transform-origin: 0 0;
}
.circle {
  position: absolute;
  border-radius: 50%;
  background: radial-gradient(circle, #ffffff 50%, #fff8d8 100%);
  box-shadow: 0 0 120px rgba(255,255,255,1), 0 0 220px rgba(255,255,255,0.85);
  transition: all 0.3s ease;
  transform: translate(-50%, -50%);
}
.zoom-display {
  position: fixed;
  bottom: 15px;
  left: 15px;
  color: rgba(255,255,255,0.8);
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  font-size: 11px;
  background: rgba(0,0,0,0.7);
  padding: 6px 10px;
  border-radius: 8px;
  z-index: 1000;
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255,255,255,0.1);
  cursor: pointer;
}
.zoom-display input {
  background: transparent;
  border: 1px solid rgba(255,255,255,0.3);
  border-radius: 3px;
  color: white;
  padding: 2px 4px;
  width: 70px;
  font-size: 11px;
  text-align: center;
}
.version-display {
  position: fixed;
  bottom: 15px;
  right: 15px;
  color: rgba(255,255,255,0.6);
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  font-size: 10px;
  background: rgba(0,0,0,0.7);
  padding: 4px 8px;
  border-radius: 6px;
  z-index: 1000;
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255,255,255,0.1);
}
.sun-properties {
  position: fixed;
  top: 15px;
  left: 15px;
  color: white;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  font-size: 11px;
  background: rgba(20,20,30,0.85);
  padding: 10px;
  border-radius: 12px;
  z-index: 1000;
  backdrop-filter: blur(15px);
  border: 1px solid rgba(100,120,255,0.2);
  line-height: 1.3;
  min-width: 220px;
  max-width: 90vw;
  transition: transform 0.3s ease;
  box-shadow: 0 8px 32px rgba(0,0,0,0.3);
}
.sun-properties.minimized {
  transform: translateY(calc(-100% + 30px));
}
.sun-properties.minimized .properties-content {
  display: none;
}
.sun-properties h3 {
  margin: 0 0 6px 0;
  font-size: 12px;
  text-align: center;
  color: #fff8d8;
  cursor: pointer;
  user-select: none;
  font-weight: 600;
  padding: 3px;
}
.properties-content {
  transition: opacity 0.3s ease;
}
.property {
  margin-bottom: 5px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 10px;
}
.property input {
  width: 55px;
  background: rgba(255,255,255,0.1);
  border: 1px solid rgba(255,255,255,0.2);
  border-radius: 4px;
  color: white;
  padding: 2px 4px;
  text-align: right;
  font-size: 10px;
}
.property-controls {
  display: flex;
  gap: 2px;
  margin-left: 4px;
}
.inc-dec-btn {
  background: rgba(255,255,255,0.15);
  border: 1px solid rgba(255,255,255,0.25);
  border-radius: 3px;
  color: white;
  cursor: pointer;
  width: 17px;
  height: 17px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 9px;
  transition: all 0.2s ease;
}
.inc-dec-btn:hover {
  background: rgba(255,255,255,0.25);
}
.lock-btn {
  background: rgba(255,255,255,0.15);
  border: 1px solid rgba(255,255,255,0.25);
  border-radius: 3px;
  color: white;
  cursor: pointer;
  padding: 2px 5px;
  margin: 0 1px;
  font-size: 9px;
  transition: all 0.2s ease;
}
.lock-btn.locked {
  background: rgba(255,100,100,0.4);
  border-color: rgba(255,100,100,0.6);
}
.temperature {
  font-weight: 600;
}
.star-type {
  color: #ffeb3b;
  font-weight: 600;
}
.lock-controls {
  margin-top: 6px;
  padding-top: 6px;
  border-top: 1px solid rgba(255,255,255,0.15);
  font-size: 10px;
}
.lock-controls div {
  margin-bottom: 2px;
}
.save-load-panel {
  position: fixed;
  top: 15px;
  right: 15px;
  color: white;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  font-size: 11px;
  background: rgba(20,20,30,0.85);
  padding: 10px;
  border-radius: 12px;
  z-index: 1000;
  backdrop-filter: blur(15px);
  border: 1px solid rgba(100,120,255,0.2);
  line-height: 1.3;
  min-width: 150px;
  max-width: 90vw;
  transition: transform 0.3s ease;
  box-shadow: 0 8px 32px rgba(0,0,0,0.3);
}
.save-load-panel.minimized {
  transform: translateY(calc(-100% + 30px));
}
.save-load-panel.minimized .save-load-content {
  display: none;
}
.save-load-panel h3 {
  margin: 0 0 6px 0;
  font-size: 12px;
  text-align: center;
  color: #fff8d8;
  cursor: pointer;
  user-select: none;
  font-weight: 600;
  padding: 3px;
}
.save-load-content {
  transition: opacity 0.3s ease;
}
.save-load-btn {
  background: rgba(100,150,255,0.3);
  border: 1px solid rgba(100,150,255,0.5);
  border-radius: 5px;
  color: white;
  cursor: pointer;
  padding: 5px 8px;
  margin: 2px 0;
  width: 100%;
  font-size: 10px;
  transition: all 0.2s ease;
  font-weight: 500;
}
.save-load-btn:hover {
  background: rgba(100,150,255,0.5);
}
.saved-stars-list {
  max-height: 100px;
  overflow-y: auto;
  margin: 5px 0;
  border: 1px solid rgba(255,255,255,0.15);
  border-radius: 6px;
  padding: 3px;
  background: rgba(0,0,0,0.3);
}
.star-item {
  padding: 4px 5px;
  margin: 1px 0;
  background: rgba(255,255,255,0.08);
  border-radius: 4px;
  cursor: pointer;
  font-size: 9px;
  transition: all 0.2s ease;
}
.star-item:hover {
  background: rgba(255,255,255,0.15);
}
.star-item.active {
  background: rgba(100,150,255,0.3);
  border: 1px solid rgba(100,150,255,0.5);
}
.delete-star {
  float: right;
  color: #ff6b6b;
  cursor: pointer;
  margin-left: 5px;
  font-weight: bold;
  font-size: 11px;
}
.increment-control {
  margin: 6px 0;
  padding: 5px 0;
  border-top: 1px solid rgba(255,255,255,0.15);
  border-bottom: 1px solid rgba(255,255,255,0.15);
  font-size: 10px;
}
.increment-control input {
  width: 45px;
  background: rgba(255,255,255,0.1);
  border: 1px solid rgba(255,255,255,0.2);
  border-radius: 4px;
  color: white;
  padding: 2px 4px;
  text-align: center;
  font-size: 10px;
}
.temperature-unit-control {
  margin: 6px 0;
  padding: 5px 0;
  border-top: 1px solid rgba(255,255,255,0.15);
  font-size: 10px;
}
.temperature-unit-control select {
  width: 100%;
  background: rgba(255,255,255,0.1);
  border: 1px solid rgba(255,255,255,0.2);
  border-radius: 4px;
  color: white;
  padding: 3px;
  font-size: 10px;
}
.temperature-unit-control option {
  background: rgba(30,30,40,0.95);
}
@media (max-width: 768px) and (orientation: portrait) {
  .sun-properties, .save-load-panel {
    position: fixed;
    top: 10px;
    left: 10px;
    right: 10px;
    max-width: none;
    min-width: auto;
    transition: transform 0.3s ease;
  }
  .save-load-panel {
    top: auto;
    bottom: 10px;
    left: 10px;
    right: 10px;
  }
  .sun-properties.minimized {
    transform: translateY(calc(-100% + 30px));
  }
  .save-load-panel.minimized {
    transform: translateY(calc(100% - 30px));
  }
  .zoom-display, .version-display {
    bottom: 10px;
    font-size: 10px;
    padding: 4px 8px;
  }
  .version-display {
    display: none;
  }
}
@media (max-height: 600px) {
  .sun-properties, .save-load-panel {
    font-size: 10px;
    padding: 6px;
  }
  .property {
    margin-bottom: 3px;
    font-size: 9px;
  }
  .saved-stars-list {
    max-height: 70px;
  }
}
@media (orientation: landscape) and (min-width: 768px) {
  .save-load-panel {
    min-width: 140px;
  }
}
</style>
</head>
<body>
  <div class="sun-properties minimized">
    <h3 id="propertiesTitle">Star: <input type="text" id="starName" value="Sun" style="background: transparent; border: none; color: #fff8d8; width: 70px; font-size: 12px;"></h3>
    <div class="properties-content">
      <div class="property">Age: <input type="text" id="age" value="4570"> Ma
        <div class="property-controls">
          <button class="inc-dec-btn" data-target="age" data-direction="1">+</button>
          <button class="inc-dec-btn" data-target="age" data-direction="-1">-</button>
        </div>
      </div>
      <div class="property">Mass: <input type="text" id="mass" value="1.00"> Sun
        <div class="property-controls">
          <button class="inc-dec-btn" data-target="mass" data-direction="1">+</button>
          <button class="inc-dec-btn" data-target="mass" data-direction="-1">-</button>
        </div>
      </div>
      <div class="property">Radius: <input type="text" id="radius" value="1.00"> Sun
        <div class="property-controls">
          <button class="inc-dec-btn" data-target="radius" data-direction="1">+</button>
          <button class="inc-dec-btn" data-target="radius" data-direction="-1">-</button>
        </div>
      </div>
      <div class="property">Density: <input type="text" id="density" value="1.41"> g/cm³
        <div class="property-controls">
          <button class="inc-dec-btn" data-target="density" data-direction="1">+</button>
          <button class="inc-dec-btn" data-target="density" data-direction="-1">-</button>
        </div>
      </div>
      <div class="property">Temperature: <input type="text" id="temperature" value="5778"> <span id="temperatureUnitDisplay">K</span>
        <div class="property-controls">
          <button class="inc-dec-btn" data-target="temperature" data-direction="1">+</button>
          <button class="inc-dec-btn" data-target="temperature" data-direction="-1">-</button>
        </div>
      </div>
      <div class="property">Luminosity: <input type="text" id="luminosity" value="1.00"> Sun
        <div class="property-controls">
          <button class="inc-dec-btn" data-target="luminosity" data-direction="1">+</button>
          <button class="inc-dec-btn" data-target="luminosity" data-direction="-1">-</button>
        </div>
      </div>
      <div class="property">Spectral Classification: <span id="type" class="star-type">G</span></div>
      <div class="lock-controls">
        <div>Lock variable: 
          <button class="lock-btn locked" data-target="mass">Mass</button>
          <button class="lock-btn" data-target="radius">Radius</button>
          <button class="lock-btn" data-target="density">Density</button>
        </div>
      </div>
    </div>
  </div>
  <div class="save-load-panel minimized">
    <h3 id="saveLoadTitle">Options</h3>
    <div class="save-load-content">
      <button class="save-load-btn" id="flyToStarBtn">Fly to Star</button>
      <button class="save-load-btn" id="resetBtn">Reset to Sun</button>
      <button class="save-load-btn" id="saveBtn">Save Current Star</button>
      <button class="save-load-btn" id="loadBtn">Load Selected Star</button>
      <button class="save-load-btn" id="shareBtn">Share Star</button>
      <div class="increment-control">
        <div>Increment by: <input type="text" id="incrementValue" value="0.1"></div>
      </div>
      <div class="temperature-unit-control">
        <div>Temperature Unit: 
          <select id="temperatureUnit">
            <option value="K">Kelvin (K)</option>
            <option value="C">Celsius (°C)</option>
            <option value="F">Fahrenheit (°F)</option>
          </select>
        </div>
      </div>
      <div class="saved-stars-list" id="savedStarsList"></div>
    </div>
  </div>
  <div class="zoom-display" id="zoomDisplay">Zoom: 1.0000x</div>
  <div class="version-display">Version: 1.2.1</div>
  <div class="center-wrap">
    <div class="circle" aria-hidden="true"></div>
  </div>
  <script>
let scale = 1;
let posX = 0;
let posY = 0;
let lastTouchDistance = null;
let isDragging = false;
let lastTouchX = 0;
let lastTouchY = 0;
const minScale = 0.00002;
const maxScale = 50;
const container = document.querySelector('.center-wrap');
const zoomDisplay = document.querySelector('.zoom-display');
const circle = document.querySelector('.circle');
const propertiesPanel = document.querySelector('.sun-properties');
const propertiesTitle = document.getElementById('propertiesTitle');
const saveLoadPanel = document.querySelector('.save-load-panel');
const saveLoadTitle = document.getElementById('saveLoadTitle');
const inputs = {
  age: document.getElementById('age'),
  mass: document.getElementById('mass'),
  radius: document.getElementById('radius'),
  density: document.getElementById('density'),
  temperature: document.getElementById('temperature'),
  luminosity: document.getElementById('luminosity')
};
const typeDisplay = document.getElementById('type');
const resetBtn = document.getElementById('resetBtn');
const starName = document.getElementById('starName');
const incrementValue = document.getElementById('incrementValue');
const saveBtn = document.getElementById('saveBtn');
const loadBtn = document.getElementById('loadBtn');
const flyToStarBtn = document.getElementById('flyToStarBtn');
const shareBtn = document.getElementById('shareBtn');
const savedStarsList = document.getElementById('savedStarsList');
const temperatureUnitSelect = document.getElementById('temperatureUnit');
const temperatureUnitDisplay = document.getElementById('temperatureUnitDisplay');
let lockedVariable = 'mass';
let savedStars = JSON.parse(localStorage.getItem('savedStars') || '[]');
let selectedStarId = null;
let temperatureUnit = 'K';
let isEditingZoom = false;
updateSavedStarsList();
loadFromURL();
function clampValue(value, min, max) {
  return Math.max(min, Math.min(max, parseFloat(value) || min));
}
function updateInputValue(input, value, min, max) {
  const clamped = clampValue(value, min, max);
  input.value = clamped.toFixed(4);
  return clamped;
}
function getGlowColor(temp) {
  temp = Math.max(0, Math.min(99999, temp));
  const colors = [
    { temp: 0,     color: { r: 0,   g: 0,   b: 0 } },
    { temp: 1000,   color: { r: 0,   g: 0,   b: 0 } },
    { temp: 3000,  color: { r: 255, g: 0,   b: 0 } },
    { temp: 4500,  color: { r: 255, g: 165, b: 0 } },
    { temp: 6000,  color: { r: 255, g: 255, b: 0 } },
    { temp: 7500,  color: { r: 255, g: 255, b: 255 } },
    { temp: 25000, color: { r: 173, g: 216, b: 255 } },
    { temp: 50000, color: { r: 0,   g: 0,   b: 255 } }
  ];
  for (let i = 0; i < colors.length - 1; i++) {
    if (temp >= colors[i].temp && temp <= colors[i + 1].temp) {
      const ratio = (temp - colors[i].temp) / (colors[i + 1].temp - colors[i].temp);
      const r = Math.round(colors[i].color.r + (colors[i + 1].color.r - colors[i].color.r) * ratio);
      const g = Math.round(colors[i].color.g + (colors[i + 1].color.g - colors[i].color.g) * ratio);
      const b = Math.round(colors[i].color.b + (colors[i + 1].color.b - colors[i].color.b) * ratio);
      return `rgba(${r}, ${g}, ${b}, 0.8)`;
    }
  }
  return `rgba(0, 0, 255, 0.8)`;
}
function getTemperatureColor(temp) {
  temp = Math.max(0, Math.min(99999, temp));
  const colors = [
    { temp: 0,     color: { r: 0,   g: 0,   b: 0 } },
    { temp: 850,   color: { r: 0,   g: 0,   b: 0 } },
    { temp: 2800,  color: { r: 255, g: 0,   b: 0 } },
    { temp: 3500,  color: { r: 255, g: 165, b: 0 } },
    { temp: 4200,  color: { r: 255, g: 255, b: 0 } },
    { temp: 6000,  color: { r: 255, g: 255, b: 255 } },
    { temp: 15000, color: { r: 173, g: 216, b: 255 } },
    { temp: 30000, color: { r: 0,   g: 0,   b: 255 } }
  ];
  for (let i = 0; i < colors.length - 1; i++) {
    if (temp >= colors[i].temp && temp <= colors[i + 1].temp) {
      const ratio = (temp - colors[i].temp) / (colors[i + 1].temp - colors[i].temp);
      const r = Math.round(colors[i].color.r + (colors[i + 1].color.r - colors[i].color.r) * ratio);
      const g = Math.round(colors[i].color.g + (colors[i + 1].color.g - colors[i].color.g) * ratio);
      const b = Math.round(colors[i].color.b + (colors[i + 1].color.b - colors[i].color.b) * ratio);
      return `rgb(${r}, ${g}, ${b})`;
    }
  }
  return `rgb(0, 0, 255)`;
}
function convertTemperature(value, fromUnit, toUnit) {
  if (fromUnit === toUnit) return value;
  let kelvin = value;
  if (fromUnit === 'C') {
    kelvin = value + 273.15;
  } else if (fromUnit === 'F') {
    kelvin = (value - 32) * 5/9 + 273.15;
  }
  if (toUnit === 'K') return kelvin;
  if (toUnit === 'C') return kelvin - 273.15;
  if (toUnit === 'F') return (kelvin - 273.15) * 9/5 + 32;
  return value;
}
function updateStarAppearance() {
  const radius = clampValue(inputs.radius.value, 0.08, 3000);
  let temperature = parseFloat(inputs.temperature.value) || 5778; 
  if (temperatureUnit !== 'K') {
    temperature = convertTemperature(temperature, temperatureUnit, 'K');
  }
  const baseSize = 200;
  const size = Math.max(20, Math.min(10000, baseSize * radius));
  circle.style.width = size + 'px';
  circle.style.height = size + 'px'; 
  const tempColor = getTemperatureColor(temperature);
  const glowColor = getGlowColor(temperature);
  const brightness = Math.min(1, Math.max(0.1, temperature / 5778));
  circle.style.background = `radial-gradient(circle, ${tempColor} 50%, #fff8d8 100%)`;
  circle.style.boxShadow = `0 0 ${120 * brightness}px ${tempColor}, 0 0 ${220 * brightness}px ${glowColor}`;
  inputs.temperature.style.color = tempColor;
}
function updateStarType() {
  let temperature = parseFloat(inputs.temperature.value) || 5778;
  if (temperatureUnit !== 'K') {
    temperature = convertTemperature(temperature, temperatureUnit, 'K');
  } 
  if (temperature >= 33000) spectralClass = 'O';
  else if (temperature >= 10000) spectralClass = 'B';
  else if (temperature >= 7300) spectralClass = 'A';
  else if (temperature >= 6000) spectralClass = 'F';
  else if (temperature >= 5300) spectralClass = 'G';
  else if (temperature >= 3900) spectralClass = 'K';
else if (temperature >= 2300) spectralClass = 'M';
else if (temperature >= 1500) spectralClass = 'L';
else if (temperature >= 900) spectralClass = 'T';
  else spectralClass = 'Y';
  typeDisplay.textContent = spectralClass;
}
function calculateRadiusFromMass(mass) {
  mass = clampValue(mass, 0.08, 350);
  if (mass <= 0.09) return mass;
  if (mass < 0.5) return Math.pow(mass, 0.9);
  if (mass < 1.0) return Math.pow(mass, 0.8);
  if (mass < 1.5) return Math.pow(mass, 0.7);
  if (mass < 3.0) return Math.pow(mass, 0.65);
  if (mass < 10.0) return Math.pow(mass, 0.6);
  if (mass < 30.0) return Math.pow(mass, 0.55);
  if (mass < 100.0) return Math.pow(mass, 0.5);
  return Math.pow(mass, 0.4) * 5.5;
}
function calculateLuminosityFromMass(mass) {
  mass = clampValue(mass, 0.08, 350);
  if (mass < 0.1) {
    return 0.0002 * Math.pow(mass / 0.08, 3.5);
  }
  if (mass < 0.3) return  Math.pow(mass, 3.0);
  if (mass < 0.5) return Math.pow(mass, 3.2);
  if (mass <= 1.0) return Math.pow(mass, 3.5);
  if (mass < 2.0) return Math.pow(mass, 4.0);
  if (mass < 20.0) return Math.pow(mass, 3.5);
  if (mass < 60.0) return Math.pow(mass, 3.0);
  return Math.pow(mass, 2.0) * 800;
}
function calculateTemperatureFromMassRadiusLuminosity(mass, radius, luminosity) {
  mass = clampValue(mass, 0.08, 350);
  radius = clampValue(radius, 0.08, 3000);
  const temperature = 5778 * Math.pow(luminosity, 0.25) / Math.pow(radius, 0.5);
  if (mass < 0.1) {
    return Math.max(2000, Math.min(3000, temperature));
  }
  let minTemp, maxTemp;  
  if (mass < 0.5) {
    minTemp = 3000; maxTemp = 5000;
  } else if (mass < 1.0) {
    minTemp = 4000; maxTemp = 6000;
  } else if (mass < 1.5) {
    minTemp = 5500; maxTemp = 7000;
  } else if (mass < 3.0) {
    minTemp = 7000; maxTemp = 10000;
  } else if (mass < 10.0) {
    minTemp = 10000; maxTemp = 20000;
  } else if (mass < 30.0) {
    minTemp = 20000; maxTemp = 35000;
  } else {
    minTemp = 30000; maxTemp = 99999;
  }
  return Math.max(minTemp, Math.min(maxTemp, temperature));
}
function updateStellarPropertiesFromMass() {
  const mass = updateInputValue(inputs.mass, inputs.mass.value, 0.08, 350);
  const radius = calculateRadiusFromMass(mass);
  updateInputValue(inputs.radius, radius, 0.08, 3000);
  const luminosity = calculateLuminosityFromMass(mass); updateInputValue(inputs.luminosity, luminosity, 0.0001, 10000000);
  let temperature = calculateTemperatureFromMassRadiusLuminosity(mass, radius, luminosity);
  if (temperatureUnit !== 'K') {
    temperature = convertTemperature(temperature, 'K', temperatureUnit);
  } updateInputValue(inputs.temperature, Math.round(temperature), 0, 99999);
  updateDensityFromMassRadius();
}
function updateMassFromRadiusDensity() {
  const radius = updateInputValue(inputs.radius, inputs.radius.value, 0.08, 3000);
  const density = updateInputValue(inputs.density, inputs.density.value, 0.001, 1000);
  const mass = radius * radius * radius * (density / 1.41);
  updateInputValue(inputs.mass, mass, 0.08, 350);
}
function updateDensityFromMassRadius() {
  const mass = updateInputValue(inputs.mass, inputs.mass.value, 0.08, 350);
  const radius = updateInputValue(inputs.radius, inputs.radius.value, 0.08, 3000);
  const density = (mass / (radius * radius * radius)) * 1.41;
  updateInputValue(inputs.density, density, 0.001, 1000);
}
function updateRadiusFromMassDensity() {
  const mass = updateInputValue(inputs.mass, inputs.mass.value, 0.08, 350);
  const density = updateInputValue(inputs.density, inputs.density.value, 0.001, 1000);
  const radius = Math.pow(mass / (density / 1.41), 1/3);
  updateInputValue(inputs.radius, radius, 0.08, 3000);
}
function updateLuminosityFromRadiusTemp() {
  const radius = updateInputValue(inputs.radius, inputs.radius.value, 0.08, 3000);
  let temperature = updateInputValue(inputs.temperature, inputs.temperature.value, 0, 99999);
  if (temperatureUnit !== 'K') {
    temperature = convertTemperature(temperature, temperatureUnit, 'K');
  }
  const luminosity = radius * radius * Math.pow(temperature / 5778, 4); updateInputValue(inputs.luminosity, luminosity, 0.0001, 10000000);
}
function updateTemperatureFromRadiusLuminosity() {
  const radius = updateInputValue(inputs.radius, inputs.radius.value, 0.08, 3000);
  const luminosity = updateInputValue(inputs.luminosity, inputs.luminosity.value, 0.0001, 10000000);
  let temperature = 5778 * Math.pow(luminosity / (radius * radius), 0.25);
  if (temperatureUnit !== 'K') {
    temperature = convertTemperature(temperature, 'K', temperatureUnit);
  } updateInputValue(inputs.temperature, Math.round(temperature), 0, 99999);
}
function handleMassRadiusDensityChange() {
  if (lockedVariable === 'density') {
    updateMassFromRadiusDensity();
  } else if (lockedVariable === 'mass') {
    updateDensityFromMassRadius();
  } else if (lockedVariable === 'radius') {
    updateMassFromRadiusDensity();
  }
}
function incrementVariable(target, direction) {
  const increment = parseFloat(incrementValue.value) || 0.1;
  const currentValue = parseFloat(inputs[target].value) || 0;
  const newValue = currentValue + (direction * increment);
  inputs[target].value = Math.max(0, newValue).toFixed(4);
  inputs[target].dispatchEvent(new Event('input'));
}
function resetToSun() {
  let tempValue = 5778;
  if (temperatureUnit !== 'K') {
    tempValue = convertTemperature(5778, 'K', temperatureUnit);
  } 
  updateInputValue(inputs.age, 4570, 0, 15000);
  updateInputValue(inputs.mass, 1.0000, 0.08, 350);
  updateInputValue(inputs.radius, 1.0000, 0.08, 3000);
  updateInputValue(inputs.density, 1.4100, 0.001, 1000); updateInputValue(inputs.temperature, tempValue, 0, 99999); updateInputValue(inputs.luminosity, 1.0000, 0.0001, 10000000);
  starName.value = "Sun";
  selectedStarId = null;
  scale = 1;
  posX = 0;
  posY = 0;
  updateTransform(); 
  updateStarAppearance();
  updateStarType();
  updateSavedStarsList();
}
function flyToStar() {
  const radius = parseFloat(inputs.radius.value) || 1;
  scale = 1 / radius;
  scale = clampValue(scale, minScale, maxScale);
  posX = 0;
  posY = 0;
  updateTransform();
}
function saveCurrentStar() {
  const name = starName.value.trim() || "Unnamed Star";
  const starData = {
    id: Date.now().toString(),
    name: name,
    age: inputs.age.value,
    mass: inputs.mass.value,
    radius: inputs.radius.value,
    density: inputs.density.value,
    temperature: inputs.temperature.value,
    luminosity: inputs.luminosity.value,
    spectralType: typeDisplay.textContent,
    temperatureUnit: temperatureUnit,
    timestamp: new Date().toISOString()
  };
  const existingIndex = savedStars.findIndex(star => star.id === selectedStarId);
  if (existingIndex !== -1) {
    savedStars[existingIndex] = starData;
  } else {
    savedStars.push(starData);
  }
  localStorage.setItem('savedStars', JSON.stringify(savedStars));
  updateSavedStarsList();
  selectedStarId = starData.id;
}
function loadSelectedStar() {
  if (!selectedStarId) return;
  const starData = savedStars.find(star => star.id === selectedStarId);
  if (starData) {
    starName.value = starData.name;
    updateInputValue(inputs.age, starData.age, 0, 15000);
    updateInputValue(inputs.mass, starData.mass, 0.08, 350);
    updateInputValue(inputs.radius, starData.radius, 0.08, 3000);
    updateInputValue(inputs.density, starData.density, 0.001, 1000); 
    if (starData.temperatureUnit && starData.temperatureUnit !== temperatureUnit) {
      const convertedTemp = convertTemperature(       parseFloat(starData.temperature), 
        starData.temperatureUnit, 
        temperatureUnit
      );   updateInputValue(inputs.temperature, convertedTemp, 0, 99999);
    } else {
updateInputValue(inputs.temperature, starData.temperature, 0, 99999);
    } updateInputValue(inputs.luminosity, starData.luminosity, 0.0001, 10000000);   
    inputs.mass.dispatchEvent(new Event('input'));
    updateStarAppearance();
    updateStarType();
  }
}
function deleteStar(starId, event) {
  event.stopPropagation();
  if (confirm('Are you sure you want to delete this star?')) {
    savedStars = savedStars.filter(star => star.id !== starId);
localStorage.setItem('savedStars', JSON.stringify(savedStars));
    if (selectedStarId === starId) {
      selectedStarId = null;
    }
    updateSavedStarsList();
  }
}
function updateSavedStarsList() {
  savedStarsList.innerHTML = ''; 
  if (savedStars.length === 0) {
    savedStarsList.innerHTML = '<div style="text-align: center; padding: 10px; color: #888; font-size: 9px;">No saved stars</div>';
    return;
  } 
  savedStars.sort((a, b) => a.name.localeCompare(b.name)); 
  savedStars.forEach(star => {
    const starElement = document.createElement('div');
    starElement.className = `star-item ${star.id === selectedStarId ? 'active' : ''}`;
    starElement.innerHTML = `
      ${star.name} (${star.spectralType})
      <span class="delete-star" onclick="deleteStar('${star.id}', event)">×</span>
    `;    starElement.addEventListener('click', () => {     document.querySelectorAll('.star-item').forEach(item => item.classList.remove('active'));     starElement.classList.add('active');
      selectedStarId = star.id;
    });   savedStarsList.appendChild(starElement);
  });
}
function shareStar() {
  const starData = {
    name: starName.value,
    age: inputs.age.value,
    mass: inputs.mass.value,
    radius: inputs.radius.value,
    density: inputs.density.value,
    temperature: inputs.temperature.value,
    luminosity: inputs.luminosity.value,
    spectralType: typeDisplay.textContent,
    unit: temperatureUnit
  };
  const baseUrl = window.location.href.split('?')[0];
  const params = new URLSearchParams(); 
  Object.keys(starData).forEach(key => {
    if (starData[key]) {
      params.set(key, starData[key]);
    }
  });
  const shareUrl = `${baseUrl}?${params.toString()}`; navigator.clipboard.writeText(shareUrl).then(() => {
    const originalText = shareBtn.textContent;
    shareBtn.textContent = 'Copied!';
    setTimeout(() => {
      shareBtn.textContent = originalText;
    }, 2000);
  }).catch(() => {
    prompt('Copy this URL to share:', shareUrl);
  });
}
function loadFromURL() {
  const urlParams = new URLSearchParams(window.location.search);
  if (urlParams.size === 0) return;  
  const starData = {
    name: urlParams.get('name') || 'Sun',
    age: urlParams.get('age') || '4570',
    mass: urlParams.get('mass') || '1.00',
    radius: urlParams.get('radius') || '1.00',
    density: urlParams.get('density') || '1.41',
    temperature: urlParams.get('temperature') || '5778',
    luminosity: urlParams.get('luminosity') || '1.00',
    spectralType: urlParams.get('spectralType') || 'G',
    unit: urlParams.get('unit') || 'K'
  }; 
  starName.value = starData.name;
  updateInputValue(inputs.age, starData.age, 0, 15000);
  updateInputValue(inputs.mass, starData.mass, 0.08, 350);
  updateInputValue(inputs.radius, starData.radius, 0.08, 3000);
  updateInputValue(inputs.density, starData.density, 0.001, 1000); 
  temperatureUnit = starData.unit;
  temperatureUnitSelect.value = temperatureUnit; temperatureUnitDisplay.textContent = temperatureUnit === 'K' ? 'K' : temperatureUnit === 'C' ? '°C' : '°F'; updateInputValue(inputs.temperature, starData.temperature, 0, 99999); updateInputValue(inputs.luminosity, starData.luminosity, 0.0001, 10000000); 
  inputs.mass.dispatchEvent(new Event('input'));
  updateStarAppearance();
  updateStarType();
}
function updateTransform() {
  container.style.transform = `translate(${posX}px, ${posY}px) scale(${scale})`;  
  if (!isEditingZoom) {
    zoomDisplay.innerHTML = `Zoom: ${scale.toFixed(4)}x`;
  }
} 
function enableZoomInput() {
  isEditingZoom = true;
  zoomDisplay.innerHTML = `Zoom: <input type="text" id="zoomInput" value="${scale.toFixed(4)}" style="width: 70px;">x`;
  const zoomInput = document.getElementById('zoomInput');
  zoomInput.focus();
  zoomInput.select(); 
  function handleZoomInput() {
    const newScale = parseFloat(zoomInput.value);
    if (!isNaN(newScale) && newScale > 0) {
      scale = clampValue(newScale, minScale, maxScale);
      posX = 0;
      posY = 0;
      updateTransform();
    }
  }
  
  function finishZoomInput() {
    isEditingZoom = false;
    updateTransform();
  } zoomInput.addEventListener('change', handleZoomInput);
 zoomInput.addEventListener('blur', finishZoomInput);
zoomInput.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') {
      handleZoomInput();
      finishZoomInput();
    } else if (e.key === 'Escape') {
      finishZoomInput();
    }
  });
}
propertiesTitle.addEventListener('click', function() {
propertiesPanel.classList.toggle('minimized');
});
saveLoadTitle.addEventListener('click', function() {
saveLoadPanel.classList.toggle('minimized');
});
zoomDisplay.addEventListener('click', enableZoomInput);
document.querySelectorAll('.inc-dec-btn').forEach(btn => {
  btn.addEventListener('click', function() {
    const target = this.dataset.target;
    const direction = parseInt(this.dataset.direction);
    incrementVariable(target, direction);
  });
});
inputs.mass.addEventListener('input', function() {
  if (lockedVariable === 'mass') {
updateStellarPropertiesFromMass();
  } else {
    updateDensityFromMassRadius();
updateLuminosityFromRadiusTemp();
  }
  updateStarAppearance();
  updateStarType();
});
inputs.radius.addEventListener('input', function() {
  if (lockedVariable === 'radius') {
    updateMassFromRadiusDensity();
  } else {
    updateDensityFromMassRadius();
 } 
updateLuminosityFromRadiusTemp();
  updateStarAppearance();
  updateStarType();
});
inputs.density.addEventListener('input', function() {
  if (lockedVariable === 'density') {
    updateMassFromRadiusDensity();
  } else {
    updateRadiusFromMassDensity();
 } 
updateLuminosityFromRadiusTemp();
  updateStarAppearance();
  updateStarType();
});
inputs.temperature.addEventListener('input', function() {
updateLuminosityFromRadiusTemp();
  updateStarAppearance();
  updateStarType();
});
inputs.luminosity.addEventListener('input', function() {
updateTemperatureFromRadiusLuminosity();
  updateStarAppearance();
  updateStarType();
});
inputs.age.addEventListener('input', function() {
  updateInputValue(inputs.age, inputs.age.value, 0, 15000);
  updateStarAppearance();
});
temperatureUnitSelect.addEventListener('change', function() {
  const oldUnit = temperatureUnit;
  temperatureUnit = this.value;
temperatureUnitDisplay.textContent = temperatureUnit === 'K' ? 'K' : temperatureUnit === 'C' ? '°C' : '°F';
  if (oldUnit !== temperatureUnit) {
    const currentTemp = parseFloat(inputs.temperature.value) || 5778;
    const convertedTemp = convertTemperature(currentTemp, oldUnit, temperatureUnit);
updateInputValue(inputs.temperature, convertedTemp, 0, 99999);
    updateStarAppearance();
    updateStarType();
  }
});
resetBtn.addEventListener('click', resetToSun);
saveBtn.addEventListener('click', saveCurrentStar);
loadBtn.addEventListener('click', loadSelectedStar);
flyToStarBtn.addEventListener('click', flyToStar);
shareBtn.addEventListener('click', shareStar);
document.querySelectorAll('.lock-btn').forEach(btn => {
  btn.addEventListener('click', function() {
document.querySelectorAll('.lock-btn').forEach(b => b.classList.remove('locked'));
    this.classList.add('locked');
    lockedVariable = this.dataset.target;
  });
});
function handleTouchStart(e) {
  e.preventDefault();
  if (e.touches.length === 1) {
    isDragging = true;
    lastTouchX = e.touches[0].clientX;
    lastTouchY = e.touches[0].clientY;
  } else if (e.touches.length === 2) {
    isDragging = false;
    const touch1 = e.touches[0];
    const touch2 = e.touches[1];
    lastTouchDistance = Math.hypot(
      touch2.clientX - touch1.clientX,
      touch2.clientY - touch1.clientY
    );
  }
}
function handleTouchMove(e) {
  e.preventDefault();
  if (e.touches.length === 1 && isDragging) {
    const touchX = e.touches[0].clientX;
    const touchY = e.touches[0].clientY;
    const deltaX = touchX - lastTouchX;
    const deltaY = touchY - lastTouchY;
    posX += deltaX;
    posY += deltaY;
    lastTouchX = touchX;
    lastTouchY = touchY;
    updateTransform();
  } else if (e.touches.length === 2) {
    const touch1 = e.touches[0];
    const touch2 = e.touches[1];
    const currentDistance = Math.hypot(
      touch2.clientX - touch1.clientX,
      touch2.clientY - touch1.clientY
    );
    const screenCenterX = window.innerWidth / 2;
    const screenCenterY = window.innerHeight / 2;
    if (lastTouchDistance !== null) {
      const scaleChange = currentDistance / lastTouchDistance;
      const newScale = clampValue(scale * scaleChange, minScale, maxScale);
      const scaleRatio = newScale / scale;
      posX = screenCenterX - scaleRatio * (screenCenterX - posX);
      posY = screenCenterY - scaleRatio * (screenCenterY - posY);
      scale = newScale;
      updateTransform();
    }
    lastTouchDistance = currentDistance;
  }
}
function handleTouchEnd(e) {
  if (e.touches.length === 0) {
    isDragging = false;
    lastTouchDistance = null;
  } else if (e.touches.length === 1) {
    isDragging = true;
    lastTouchX = e.touches[0].clientX;
    lastTouchY = e.touches[0].clientY;
    lastTouchDistance = null;
  }
}
function handleWheel(e) {
  e.preventDefault();
  const zoomIntensity = 0.1;
  const wheel = e.deltaY < 0 ? 1 : -1;
  const zoom = Math.exp(wheel * zoomIntensity);
  const newScale = clampValue(scale * zoom, minScale, maxScale);
  const screenCenterX = window.innerWidth / 2;
  const screenCenterY = window.innerHeight / 2;
  const scaleRatio = newScale / scale;
  posX = screenCenterX - scaleRatio * (screenCenterX - posX);
  posY = screenCenterY - scaleRatio * (screenCenterY - posY);
  scale = newScale;
  updateTransform();
}
document.addEventListener('touchstart', handleTouchStart);
document.addEventListener('touchmove', handleTouchMove);
document.addEventListener('touchend', handleTouchEnd);
document.addEventListener('wheel', handleWheel, { passive: false });
updateStarAppearance();
updateStarType();
  </script>
</body>
                                          </html>
